<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çº¢ä¹¦å¸–å­åˆ†æå·¥å…· - Doudouç”Ÿæ—¥å¿«ä¹</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f0f8ff;
            padding-top: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        .header h1 {
            color: #1e90ff;
            font-weight: bold;
        }
        .card {
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(30, 144, 255, 0.15);
            border: none;
        }
        .card-header {
            background-color: #1e90ff;
            color: white;
            font-weight: bold;
            border-radius: 10px 10px 0 0 !important;
        }
        .url-input {
            border-radius: 20px;
            border: 2px solid #1e90ff;
        }
        .btn-analyze {
            background-color: #1e90ff;
            border-color: #1e90ff;
            border-radius: 20px;
            padding: 8px 30px;
        }
        .btn-analyze:hover {
            background-color: #0c75e0;
            border-color: #0c75e0;
        }
        .result-section {
            display: none;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #1e90ff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .suggestion-item {
            padding: 8px 12px;
            margin-bottom: 8px;
            background-color: #f0f8ff;
            border-radius: 6px;
            border-left: 4px solid #1e90ff;
        }
        .keyword-badge {
            background-color: #1e90ff;
            color: white;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        pre {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        .ai-badge {
            background-color: #4169e1;
            color: white;
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 10px;
            margin-left: 10px;
        }
        .analysis-item {
            margin-bottom: 8px;
            padding: 6px 12px;
            background-color: #f0f8ff;
            border-radius: 6px;
            border-left: 4px solid #4169e1;
        }
        .birthday-banner {
            background: linear-gradient(135deg, #1e90ff, #00bfff);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        .birthday-banner h3 {
            font-weight: bold;
            margin-bottom: 10px;
            z-index: 2;
            position: relative;
        }
        .birthday-banner p {
            font-size: 16px;
            margin-bottom: 0;
            z-index: 2;
            position: relative;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0.7;
            animation: confetti-fall 5s linear infinite;
        }
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(500px) rotate(360deg);
                opacity: 0;
            }
        }
        .balloon {
            position: absolute;
            font-size: 24px;
            color: rgba(255, 255, 255, 0.7);
            animation: balloon-float 8s ease-in-out infinite;
        }
        @keyframes balloon-float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }
        .copy-btn {
            background-color: #1e90ff;
            color: white;
            border: none;
        }
        .copy-btn:hover {
            background-color: #0c75e0;
            color: white;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #1e90ff;
            font-size: 14px;
        }
        .heart-icon {
            color: #ff6b6b;
            animation: heart-beat 1.5s ease infinite;
        }
        @keyframes heart-beat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å°çº¢ä¹¦å¸–å­åˆ†æä¸å†…å®¹ç”Ÿæˆå·¥å…·
                {% if use_ai %}
                <span class="ai-badge">AIå¢å¼ºç‰ˆ</span>
                {% endif %}
            </h1>
            <p class="text-muted">è¾“å…¥å°çº¢ä¹¦å¸–å­URLï¼Œè·å–å†…å®¹åˆ†æä¸ä¼˜åŒ–å»ºè®®</p>
        </div>
        
        <div class="birthday-banner">
            <h3><i class="fas fa-birthday-cake"></i> äº²çˆ±çš„Doudouï¼Œç”Ÿæ—¥å¿«ä¹ï¼<i class="fas fa-birthday-cake"></i></h3>
            <p>é€ä½ è¿™ä¸ªå°å·¥å…·ï¼Œå¸Œæœ›èƒ½å¸®åŠ©ä½ çš„å°çº¢ä¹¦å†…å®¹åˆ›ä½œæ›´åŠ å‡ºå½©ï¼æ„¿æ¥ä¸‹æ¥çš„ä¸€å¹´å…‰èŠ’ä¸‡ä¸ˆï¼Œæ‰€æœ‰ç¾å¥½å¦‚çº¦è€Œè‡³ <i class="fas fa-heart heart-icon"></i></p>
            <!-- æ·»åŠ æ¼‚æµ®çš„æ°”çƒå’Œäº”å½©çº¸å±‘ -->
            <div class="balloon" style="top: 10px; left: 10%;">ğŸˆ</div>
            <div class="balloon" style="top: 15px; left: 30%;">ğŸˆ</div>
            <div class="balloon" style="top: 5px; left: 50%;">ğŸˆ</div>
            <div class="balloon" style="top: 20px; left: 70%;">ğŸˆ</div>
            <div class="balloon" style="top: 8px; left: 90%;">ğŸˆ</div>
            
            <div class="confetti" style="left: 10%; background-color: #FFD700;"></div>
            <div class="confetti" style="left: 20%; background-color: #FF6347; animation-delay: 0.5s;"></div>
            <div class="confetti" style="left: 30%; background-color: #98FB98; animation-delay: 1s;"></div>
            <div class="confetti" style="left: 40%; background-color: #FF69B4; animation-delay: 1.5s;"></div>
            <div class="confetti" style="left: 50%; background-color: #87CEFA; animation-delay: 2s;"></div>
            <div class="confetti" style="left: 60%; background-color: #DDA0DD; animation-delay: 2.5s;"></div>
            <div class="confetti" style="left: 70%; background-color: #FFA500; animation-delay: 3s;"></div>
            <div class="confetti" style="left: 80%; background-color: #00CED1; animation-delay: 3.5s;"></div>
            <div class="confetti" style="left: 90%; background-color: #FF4500; animation-delay: 4s;"></div>
        </div>
        
        <div class="card">
            <div class="card-header">è¾“å…¥å¸–å­URL</div>
            <div class="card-body">
                <div class="input-group mb-3">
                    <input type="text" id="url-input" class="form-control url-input" placeholder="ä¾‹å¦‚: https://www.xiaohongshu.com/discovery/item/123456...">
                    <button class="btn btn-primary btn-analyze" id="analyze-btn">åˆ†æ</button>
                </div>
            </div>
        </div>
        
        <div id="loader" class="loader"></div>
        
        <div id="error-alert" class="alert alert-danger" style="display:none;"></div>
        
        <div id="result-section" class="result-section">
            <div class="card">
                <div class="card-header">å…³é”®è¯åˆ†æ</div>
                <div class="card-body">
                    <div id="keywords-container"></div>
                </div>
            </div>
            
            <!-- AIåˆ†æç»“æœ (ä»…åœ¨AIç‰ˆä¸­æ˜¾ç¤º) -->
            <div id="ai-analysis-card" class="card" style="display: none;">
                <div class="card-header">AIæ·±åº¦åˆ†æ</div>
                <div class="card-body">
                    <div id="ai-analysis-container">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="analysis-item">
                                    <strong>å¸–å­ä¸»é¢˜:</strong> <span id="ai-topic"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="analysis-item">
                                    <strong>äº§å“ç±»åˆ«:</strong> <span id="ai-category"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="analysis-item">
                                    <strong>å†™ä½œé£æ ¼:</strong> <span id="ai-style"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="analysis-item">
                                    <strong>ç›®æ ‡å—ä¼—:</strong> <span id="ai-audience"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="analysis-item">
                                    <strong>æƒ…æ„ŸåŸºè°ƒ:</strong> <span id="ai-tone"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- åª’ä½“åˆ†æç»“æœ -->
            <div id="media-analysis-card" class="card" style="display: none;">
                <div class="card-header">å›¾ç‰‡ä¸è§†é¢‘åˆ†æ</div>
                <div class="card-body">
                    <!-- å›¾ç‰‡åˆ†æç»“æœ -->
                    <div id="image-analysis-container" style="display: none;">
                        <h5 class="mb-3">å›¾ç‰‡åˆ†æ</h5>
                        <div id="image-analysis-list" class="row">
                            <!-- å›¾ç‰‡åˆ†æç»“æœä¼šåŠ¨æ€æ’å…¥åˆ°è¿™é‡Œ -->
                        </div>
                    </div>
                    
                    <!-- è§†é¢‘åˆ†æç»“æœ -->
                    <div id="video-analysis-container" style="display: none;">
                        <h5 class="mt-4 mb-3">è§†é¢‘åˆ†æ</h5>
                        <div class="analysis-item">
                            <strong>å†…å®¹æè¿°:</strong> <span id="video-content"></span>
                        </div>
                        <div class="analysis-item">
                            <strong>è¯†åˆ«å¯¹è±¡:</strong> <span id="video-objects"></span>
                        </div>
                        <div class="analysis-item">
                            <strong>å…³é”®è¯:</strong> <span id="video-keywords"></span>
                        </div>
                        <div class="analysis-item">
                            <strong>è´¨é‡è¯„åˆ†:</strong> <span id="video-quality"></span>
                        </div>
                        <div class="analysis-item">
                            <strong>å¸å¼•åŠ›è¯„åˆ†:</strong> <span id="video-appeal"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">ä¼˜åŒ–æ ‡é¢˜</div>
                <div class="card-body">
                    <h5 id="optimized-title" class="card-title"></h5>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button class="btn btn-sm copy-btn" data-target="optimized-title">å¤åˆ¶</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">ä¼˜åŒ–å†…å®¹</div>
                <div class="card-body">
                    <pre id="optimized-body"></pre>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button class="btn btn-sm copy-btn" data-target="optimized-body">å¤åˆ¶</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">æ”¹è¿›å»ºè®®</div>
                <div class="card-body">
                    <div id="suggestions-container"></div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">åŒé¢˜æçƒ­é—¨å¸–å­</div>
                <div class="card-body">
                    <div id="top-posts-container"></div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">åŸå§‹å†…å®¹</div>
                <div class="card-body">
                    <h5>æ ‡é¢˜</h5>
                    <p id="original-title"></p>
                    <h5>å†…å®¹</h5>
                    <pre id="original-content"></pre>
                    <h5>å›¾ç‰‡æ•°é‡</h5>
                    <p id="original-image-count"></p>
                    <h5>è§†é¢‘</h5>
                    <p id="original-video"></p>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>ç‰¹åˆ«å®šåˆ¶ Â· ä¸ºDoudouçš„ç”Ÿæ—¥ç‰¹åˆ«æ‰“é€  <i class="fas fa-heart heart-icon"></i></p>
            <p>ç¥æ„¿ä½ çš„åˆ›ä½œä¹‹è·¯å¦‚ç’€ç’¨æ˜Ÿæ²³ï¼Œé—ªè€€æ— é™å…‰èŠ’ï¼</p>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('analyze-btn').addEventListener('click', async function() {
            const url = document.getElementById('url-input').value.trim();
            
            if (!url) {
                showError('è¯·è¾“å…¥å°çº¢ä¹¦å¸–å­URL');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼Œéšè—ç»“æœå’Œé”™è¯¯ä¿¡æ¯
            document.getElementById('loader').style.display = 'block';
            document.getElementById('result-section').style.display = 'none';
            document.getElementById('error-alert').style.display = 'none';
            
            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url }),
                });
                
                const data = await response.json();
                
                // éšè—åŠ è½½åŠ¨ç”»
                document.getElementById('loader').style.display = 'none';
                
                if (data.error) {
                    showError(data.error);
                    return;
                }
                
                // æ˜¾ç¤ºç»“æœ
                displayResults(data);
                
                // æ·»åŠ æˆåŠŸåˆ†æçš„åº†ç¥æ•ˆæœ
                showCelebration();
            } catch (error) {
                document.getElementById('loader').style.display = 'none';
                showError('è¯·æ±‚å¤±è´¥: ' + error.message);
            }
        });
        
        function showError(message) {
            const errorAlert = document.getElementById('error-alert');
            errorAlert.textContent = message;
            errorAlert.style.display = 'block';
        }
        
        function displayResults(data) {
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('result-section').style.display = 'block';
            
            // æ˜¾ç¤ºå…³é”®è¯
            const keywordsContainer = document.getElementById('keywords-container');
            keywordsContainer.innerHTML = '';
            data.analysis.keywords.forEach(keyword => {
                const badge = document.createElement('span');
                badge.className = 'badge keyword-badge';
                badge.textContent = keyword;
                keywordsContainer.appendChild(badge);
            });
            
            // å¦‚æœæœ‰AIåˆ†æç»“æœï¼Œæ˜¾ç¤ºAIåˆ†æå¡ç‰‡
            if (data.analysis.ai_analysis) {
                const aiCard = document.getElementById('ai-analysis-card');
                aiCard.style.display = 'block';
                
                // å¡«å……åˆ†ææ•°æ®
                document.getElementById('ai-topic').textContent = data.analysis.ai_analysis.topic || 'æœªæä¾›';
                document.getElementById('ai-category').textContent = data.analysis.ai_analysis.category || 'æœªæä¾›';
                document.getElementById('ai-style').textContent = data.analysis.ai_analysis.style || 'æœªæä¾›';
                document.getElementById('ai-audience').textContent = data.analysis.ai_analysis.audience || 'æœªæä¾›';
                document.getElementById('ai-tone').textContent = data.analysis.ai_analysis.tone || 'æœªæä¾›';
            } else {
                document.getElementById('ai-analysis-card').style.display = 'none';
            }
            
            // å¦‚æœæœ‰åª’ä½“åˆ†æç»“æœï¼Œæ˜¾ç¤ºåª’ä½“åˆ†æå¡ç‰‡
            if (data.analysis.media_analysis) {
                const mediaCard = document.getElementById('media-analysis-card');
                mediaCard.style.display = 'block';
                
                // å¤„ç†å›¾ç‰‡åˆ†æç»“æœ
                if (data.analysis.media_analysis.image_analyses && data.analysis.media_analysis.image_analyses.length > 0) {
                    const imageContainer = document.getElementById('image-analysis-container');
                    imageContainer.style.display = 'block';
                    
                    const imageList = document.getElementById('image-analysis-list');
                    imageList.innerHTML = '';
                    
                    data.analysis.media_analysis.image_analyses.forEach((img, index) => {
                        if (!img.error) {
                            const col = document.createElement('div');
                            col.className = 'col-md-4 mb-3';
                            
                            const card = document.createElement('div');
                            card.className = 'card h-100';
                            
                            const cardBody = document.createElement('div');
                            cardBody.className = 'card-body';
                            
                            // æ·»åŠ å›¾ç‰‡ç¼–å·
                            const imgHeader = document.createElement('h6');
                            imgHeader.className = 'card-title border-bottom pb-2 mb-3';
                            imgHeader.textContent = 'å›¾ç‰‡ #' + (index + 1);
                            
                            // å†…å®¹æè¿°
                            const content = document.createElement('p');
                            content.className = 'card-text small';
                            content.innerHTML = '<strong>æè¿°:</strong> ' + (img.content || 'æœªæä¾›');
                            
                            // ç‰©å“è¯†åˆ«
                            const objects = document.createElement('p');
                            objects.className = 'card-text small';
                            objects.innerHTML = '<strong>è¯†åˆ«å¯¹è±¡:</strong> ' + (img.objects && img.objects.length > 0 ? img.objects.join(', ') : 'æ— ');
                            
                            // é£æ ¼
                            const style = document.createElement('p');
                            style.className = 'card-text small';
                            style.innerHTML = '<strong>é£æ ¼:</strong> ' + (img.style || 'æœªè¯†åˆ«');
                            
                            // è¯„åˆ†
                            const scores = document.createElement('p');
                            scores.className = 'card-text small';
                            scores.innerHTML = '<strong>è´¨é‡è¯„åˆ†:</strong> ' + img.quality + '/10 &nbsp; <strong>å¸å¼•åŠ›:</strong> ' + img.appeal + '/10';
                            
                            // å…³é”®è¯
                            const keywords = document.createElement('p');
                            keywords.className = 'card-text small';
                            keywords.innerHTML = '<strong>å…³é”®è¯:</strong> ' + (img.keywords && img.keywords.length > 0 ? img.keywords.join(', ') : 'æ— ');
                            
                            // ç»„åˆå¡ç‰‡å†…å®¹
                            cardBody.appendChild(imgHeader);
                            cardBody.appendChild(content);
                            cardBody.appendChild(objects);
                            cardBody.appendChild(style);
                            cardBody.appendChild(scores);
                            cardBody.appendChild(keywords);
                            
                            card.appendChild(cardBody);
                            col.appendChild(card);
                            imageList.appendChild(col);
                        }
                    });
                } else {
                    document.getElementById('image-analysis-container').style.display = 'none';
                }
                
                // å¤„ç†è§†é¢‘åˆ†æç»“æœ
                if (data.analysis.media_analysis.video_analysis && !data.analysis.media_analysis.video_analysis.error) {
                    const videoContainer = document.getElementById('video-analysis-container');
                    videoContainer.style.display = 'block';
                    
                    const video = data.analysis.media_analysis.video_analysis;
                    
                    // å¡«å……è§†é¢‘åˆ†ææ•°æ®
                    document.getElementById('video-content').textContent = video.content || 'æœªæä¾›';
                    document.getElementById('video-objects').textContent = video.objects && video.objects.length > 0 ? video.objects.join(', ') : 'æ— ';
                    document.getElementById('video-keywords').textContent = video.keywords && video.keywords.length > 0 ? video.keywords.join(', ') : 'æ— ';
                    document.getElementById('video-quality').textContent = video.quality + '/10';
                    document.getElementById('video-appeal').textContent = video.appeal + '/10';
                } else {
                    document.getElementById('video-analysis-container').style.display = 'none';
                }
            } else {
                document.getElementById('media-analysis-card').style.display = 'none';
            }
            
            // æ˜¾ç¤ºä¼˜åŒ–æ ‡é¢˜
            document.getElementById('optimized-title').textContent = data.optimized.title;
            
            // æ˜¾ç¤ºä¼˜åŒ–å†…å®¹
            document.getElementById('optimized-body').textContent = data.optimized.body;
            
            // æ˜¾ç¤ºå»ºè®®
            const suggestionsContainer = document.getElementById('suggestions-container');
            suggestionsContainer.innerHTML = '';
            data.optimized.suggestions.forEach(suggestion => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                div.textContent = suggestion;
                suggestionsContainer.appendChild(div);
            });
            
            // æ˜¾ç¤ºç›¸å…³çƒ­é—¨å¸–å­
            const topPostsContainer = document.getElementById('top-posts-container');
            topPostsContainer.innerHTML = '';
            const topPostsList = document.createElement('ol');
            topPostsList.className = 'list-group list-group-numbered';
            data.analysis.top_posts.forEach(post => {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-start';
                
                const div = document.createElement('div');
                div.className = 'ms-2 me-auto';
                div.textContent = post.title;
                
                const badge = document.createElement('span');
                badge.className = 'badge bg-primary rounded-pill';
                badge.textContent = post.likes + ' èµ';
                
                li.appendChild(div);
                li.appendChild(badge);
                topPostsList.appendChild(li);
            });
            topPostsContainer.appendChild(topPostsList);
            
            // æ˜¾ç¤ºåŸå§‹å†…å®¹
            document.getElementById('original-title').textContent = data.original.title;
            document.getElementById('original-content').textContent = data.original.text;
            document.getElementById('original-image-count').textContent = 
                data.original.images ? data.original.images.length + ' å¼ ' : '0 å¼ ';
            document.getElementById('original-video').textContent = 
                data.original.video ? 'æœ‰' : 'æ— ';
        }
        
        // æ·»åŠ åˆ†ææˆåŠŸçš„åº†ç¥æ•ˆæœ
        function showCelebration() {
            // æ’­æ”¾ç¤¼èŠ±æ•ˆæœ
            for (let i = 0; i < 50; i++) {
                createConfetti();
            }
        }
        
        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.width = (Math.random() * 8 + 5) + 'px';
            confetti.style.height = (Math.random() * 8 + 5) + 'px';
            confetti.style.backgroundColor = getRandomColor();
            confetti.style.animationDelay = Math.random() * 5 + 's';
            document.body.appendChild(confetti);
            
            // 3ç§’åç§»é™¤
            setTimeout(() => {
                confetti.remove();
            }, 5000);
        }
        
        function getRandomColor() {
            const colors = ['#1e90ff', '#87CEFA', '#00BFFF', '#4169E1', '#0000CD', '#6495ED', '#4682B4'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // å¤åˆ¶åŠŸèƒ½
        document.querySelectorAll('.copy-btn').forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const text = document.getElementById(targetId).textContent;
                
                navigator.clipboard.writeText(text).then(() => {
                    const originalText = this.textContent;
                    this.textContent = 'å·²å¤åˆ¶!';
                    setTimeout(() => {
                        this.textContent = originalText;
                    }, 2000);
                });
            });
        });
    </script>
</body>
</html> 