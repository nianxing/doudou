<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çº¢ä¹¦å¸–å­åˆ†æå·¥å…· - Doudouç”Ÿæ—¥å¿«ä¹</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f0f8ff;
            padding-top: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        .header h1 {
            color: #1e90ff;
            font-weight: bold;
        }
        .card {
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(30, 144, 255, 0.15);
            border: none;
        }
        .card-header {
            background-color: #1e90ff;
            color: white;
            font-weight: bold;
            border-radius: 10px 10px 0 0 !important;
        }
        .url-input {
            border-radius: 20px;
            border: 2px solid #1e90ff;
        }
        .btn-analyze {
            background-color: #1e90ff;
            border-color: #1e90ff;
            border-radius: 20px;
            padding: 8px 30px;
        }
        .btn-analyze:hover {
            background-color: #0c75e0;
            border-color: #0c75e0;
        }
        .result-section {
            display: none;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #1e90ff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .suggestion-item {
            padding: 8px 12px;
            margin-bottom: 8px;
            background-color: #f0f8ff;
            border-radius: 6px;
            border-left: 4px solid #1e90ff;
        }
        .keyword-badge {
            background-color: #1e90ff;
            color: white;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        pre {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        .ai-badge {
            background-color: #4169e1;
            color: white;
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 10px;
            margin-left: 10px;
        }
        .analysis-item {
            margin-bottom: 8px;
            padding: 6px 12px;
            background-color: #f0f8ff;
            border-radius: 6px;
            border-left: 4px solid #4169e1;
        }
        .birthday-banner {
            background: linear-gradient(135deg, #1e90ff, #00bfff);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        .birthday-banner h3 {
            font-weight: bold;
            margin-bottom: 10px;
            z-index: 2;
            position: relative;
        }
        .birthday-banner p {
            font-size: 16px;
            margin-bottom: 0;
            z-index: 2;
            position: relative;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0.7;
            animation: confetti-fall 5s linear infinite;
        }
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(500px) rotate(360deg);
                opacity: 0;
            }
        }
        .balloon {
            position: absolute;
            font-size: 24px;
            color: rgba(255, 255, 255, 0.7);
            animation: balloon-float 8s ease-in-out infinite;
        }
        @keyframes balloon-float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }
        .copy-btn {
            background-color: #1e90ff;
            color: white;
            border: none;
        }
        .copy-btn:hover {
            background-color: #0c75e0;
            color: white;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #1e90ff;
            font-size: 14px;
        }
        .heart-icon {
            color: #ff6b6b;
            animation: heart-beat 1.5s ease infinite;
        }
        @keyframes heart-beat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        .manual-input-form {
            display: none;
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .toggle-manual-btn {
            margin-top: 10px;
            background-color: #6c757d;
            border-color: #6c757d;
        }
        .image-preview {
            max-width: 150px;
            max-height: 150px;
            margin: 5px;
            border-radius: 5px;
        }
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å°çº¢ä¹¦å¸–å­åˆ†æä¸å†…å®¹ç”Ÿæˆå·¥å…·
                {% if use_ai %}
                <span class="ai-badge">AIå¢å¼ºç‰ˆ</span>
                {% endif %}
            </h1>
            <p class="text-muted">è¾“å…¥å°çº¢ä¹¦å¸–å­URLï¼Œè·å–å†…å®¹åˆ†æä¸ä¼˜åŒ–å»ºè®®</p>
        </div>
        
        <div class="birthday-banner">
            <h3><i class="fas fa-birthday-cake"></i> äº²çˆ±çš„Doudouï¼Œç”Ÿæ—¥å¿«ä¹ï¼<i class="fas fa-birthday-cake"></i></h3>
            <p>é€ä½ è¿™ä¸ªå°å·¥å…·ï¼Œå¸Œæœ›èƒ½å¸®åŠ©ä½ çš„å°çº¢ä¹¦å†…å®¹åˆ›ä½œæ›´åŠ å‡ºå½©ï¼æ„¿æ¥ä¸‹æ¥çš„ä¸€å¹´å…‰èŠ’ä¸‡ä¸ˆï¼Œæ‰€æœ‰ç¾å¥½å¦‚çº¦è€Œè‡³ <i class="fas fa-heart heart-icon"></i></p>
            <!-- æ·»åŠ æ¼‚æµ®çš„æ°”çƒå’Œäº”å½©çº¸å±‘ -->
            <div class="balloon" style="top: 10px; left: 10%;">ğŸˆ</div>
            <div class="balloon" style="top: 15px; left: 30%;">ğŸˆ</div>
            <div class="balloon" style="top: 5px; left: 50%;">ğŸˆ</div>
            <div class="balloon" style="top: 20px; left: 70%;">ğŸˆ</div>
            <div class="balloon" style="top: 8px; left: 90%;">ğŸˆ</div>
            
            <div class="confetti" style="left: 10%; background-color: #FFD700;"></div>
            <div class="confetti" style="left: 20%; background-color: #FF6347; animation-delay: 0.5s;"></div>
            <div class="confetti" style="left: 30%; background-color: #98FB98; animation-delay: 1s;"></div>
            <div class="confetti" style="left: 40%; background-color: #FF69B4; animation-delay: 1.5s;"></div>
            <div class="confetti" style="left: 50%; background-color: #87CEFA; animation-delay: 2s;"></div>
            <div class="confetti" style="left: 60%; background-color: #DDA0DD; animation-delay: 2.5s;"></div>
            <div class="confetti" style="left: 70%; background-color: #FFA500; animation-delay: 3s;"></div>
            <div class="confetti" style="left: 80%; background-color: #00CED1; animation-delay: 3.5s;"></div>
            <div class="confetti" style="left: 90%; background-color: #FF4500; animation-delay: 4s;"></div>
        </div>
        
        <div class="card">
            <div class="card-header">è¾“å…¥å¸–å­URL</div>
            <div class="card-body">
                <div class="input-group mb-3">
                    <input type="text" id="url-input" class="form-control url-input" placeholder="ä¾‹å¦‚: https://www.xiaohongshu.com/discovery/item/123456...">
                    <button class="btn btn-primary btn-analyze" id="analyze-btn">åˆ†æ</button>
                </div>
                <button type="button" id="toggle-manual-btn" class="btn btn-secondary toggle-manual-btn">æ‰‹åŠ¨è¾“å…¥å†…å®¹</button>
            </div>
        </div>
        
        <div id="loader" class="loader"></div>
        
        <div id="error-alert" class="alert alert-danger" style="display:none;"></div>
        
        <div id="result-section" class="result-section">
            <div class="card">
                <div class="card-header">å…³é”®è¯åˆ†æ</div>
                <div class="card-body">
                    <div id="keywords-container"></div>
                </div>
            </div>
            
            <!-- AIåˆ†æç»“æœ (ä»…åœ¨AIç‰ˆä¸­æ˜¾ç¤º) -->
            <div id="ai-analysis-card" class="card" style="display: none;">
                <div class="card-header">AIæ·±åº¦åˆ†æ</div>
                <div class="card-body">
                    <div id="ai-analysis-container">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="analysis-item">
                                    <strong>å¸–å­ä¸»é¢˜:</strong> <span id="ai-topic"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="analysis-item">
                                    <strong>äº§å“ç±»åˆ«:</strong> <span id="ai-category"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="analysis-item">
                                    <strong>å†™ä½œé£æ ¼:</strong> <span id="ai-style"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="analysis-item">
                                    <strong>ç›®æ ‡å—ä¼—:</strong> <span id="ai-audience"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="analysis-item">
                                    <strong>æƒ…æ„ŸåŸºè°ƒ:</strong> <span id="ai-tone"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- åª’ä½“åˆ†æç»“æœ -->
            <div id="media-analysis-card" class="card" style="display: none;">
                <div class="card-header">å›¾ç‰‡ä¸è§†é¢‘åˆ†æ</div>
                <div class="card-body">
                    <!-- å›¾ç‰‡åˆ†æç»“æœ -->
                    <div id="image-analysis-container" style="display: none;">
                        <h5 class="mb-3">å›¾ç‰‡åˆ†æ</h5>
                        <div id="image-analysis-list" class="row">
                            <!-- å›¾ç‰‡åˆ†æç»“æœä¼šåŠ¨æ€æ’å…¥åˆ°è¿™é‡Œ -->
                        </div>
                    </div>
                    
                    <!-- è§†é¢‘åˆ†æç»“æœ -->
                    <div id="video-analysis-container" style="display: none;">
                        <h5 class="mt-4 mb-3">è§†é¢‘åˆ†æ</h5>
                        <div class="analysis-item">
                            <strong>å†…å®¹æè¿°:</strong> <span id="video-content"></span>
                        </div>
                        <div class="analysis-item">
                            <strong>è¯†åˆ«å¯¹è±¡:</strong> <span id="video-objects"></span>
                        </div>
                        <div class="analysis-item">
                            <strong>å…³é”®è¯:</strong> <span id="video-keywords"></span>
                        </div>
                        <div class="analysis-item">
                            <strong>è´¨é‡è¯„åˆ†:</strong> <span id="video-quality"></span>
                        </div>
                        <div class="analysis-item">
                            <strong>å¸å¼•åŠ›è¯„åˆ†:</strong> <span id="video-appeal"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">ä¼˜åŒ–æ ‡é¢˜</div>
                <div class="card-body">
                    <h5 id="optimized-title" class="card-title"></h5>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button class="btn btn-sm copy-btn" data-target="optimized-title">å¤åˆ¶</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">ä¼˜åŒ–å†…å®¹</div>
                <div class="card-body">
                    <pre id="optimized-body"></pre>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button class="btn btn-sm copy-btn" data-target="optimized-body">å¤åˆ¶</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">æ”¹è¿›å»ºè®®</div>
                <div class="card-body">
                    <div id="suggestions-container"></div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">åŒé¢˜æçƒ­é—¨å¸–å­</div>
                <div class="card-body">
                    <div id="top-posts-container"></div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">åŸå§‹å†…å®¹</div>
                <div class="card-body">
                    <h5>æ ‡é¢˜</h5>
                    <p id="original-title"></p>
                    <h5>å†…å®¹</h5>
                    <pre id="original-content"></pre>
                    <h5>å›¾ç‰‡æ•°é‡</h5>
                    <p id="original-image-count"></p>
                    <h5>è§†é¢‘</h5>
                    <p id="original-video"></p>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>ç‰¹åˆ«å®šåˆ¶ Â· ä¸ºDoudouçš„ç”Ÿæ—¥ç‰¹åˆ«æ‰“é€  <i class="fas fa-heart heart-icon"></i></p>
            <p>ç¥æ„¿ä½ çš„åˆ›ä½œä¹‹è·¯å¦‚ç’€ç’¨æ˜Ÿæ²³ï¼Œé—ªè€€æ— é™å…‰èŠ’ï¼</p>
        </div>
    </div>
    
    <div class="manual-input-form" id="manual-input-form">
        <h4>æ‰‹åŠ¨è¾“å…¥å†…å®¹</h4>
        <div class="mb-3">
            <label for="manual-title" class="form-label">æ ‡é¢˜</label>
            <input type="text" class="form-control" id="manual-title" placeholder="è¾“å…¥å¸–å­æ ‡é¢˜">
        </div>
        <div class="mb-3">
            <label for="manual-content" class="form-label">å†…å®¹</label>
            <textarea class="form-control" id="manual-content" rows="5" placeholder="è¾“å…¥å¸–å­å†…å®¹"></textarea>
        </div>
        <div class="mb-3">
            <label for="manual-images" class="form-label">å›¾ç‰‡URL (æ¯è¡Œä¸€ä¸ª)</label>
            <textarea class="form-control" id="manual-images" rows="3" placeholder="è¾“å…¥å›¾ç‰‡URLï¼Œæ¯è¡Œä¸€ä¸ª"></textarea>
        </div>
        <div class="image-preview-container" id="image-preview-container">
            <!-- å›¾ç‰‡é¢„è§ˆå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
        <button type="button" id="submit-manual" class="btn btn-primary mt-3">æäº¤æ‰‹åŠ¨è¾“å…¥</button>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ä¿®å¤é€‰æ‹©å™¨ï¼Œä½¿ç”¨æŒ‰é’®è€Œä¸æ˜¯è¡¨å•
            const urlInput = document.querySelector('#url-input');
            const analyzeBtn = document.querySelector('#analyze-btn');
            const resultSection = document.querySelector('#result-section');
            const errorAlert = document.querySelector('#error-alert');
            const loader = document.querySelector('#loader');
            const toggleManualBtn = document.getElementById('toggle-manual-btn');
            const manualInputForm = document.getElementById('manual-input-form');
            const submitManualBtn = document.getElementById('submit-manual');
            const manualImagesInput = document.getElementById('manual-images');
            const imagePreviewContainer = document.getElementById('image-preview-container');

            // æ£€æŸ¥å¿…è¦å…ƒç´ 
            if (!urlInput || !analyzeBtn) {
                console.error('å¿…è¦å…ƒç´ æœªæ‰¾åˆ°');
                return;
            }

            // åˆ‡æ¢æ‰‹åŠ¨è¾“å…¥è¡¨å•
            toggleManualBtn.addEventListener('click', function() {
                if (manualInputForm.style.display === 'block') {
                    manualInputForm.style.display = 'none';
                    toggleManualBtn.textContent = 'æ‰‹åŠ¨è¾“å…¥å†…å®¹';
                } else {
                    manualInputForm.style.display = 'block';
                    toggleManualBtn.textContent = 'éšè—æ‰‹åŠ¨è¾“å…¥';
                }
            });

            // ç›‘å¬å›¾ç‰‡URLè¾“å…¥å˜åŒ–ä»¥é¢„è§ˆå›¾ç‰‡
            manualImagesInput.addEventListener('input', function() {
                const urls = manualImagesInput.value.split('\n').filter(url => url.trim() !== '');
                imagePreviewContainer.innerHTML = '';
                
                urls.forEach(url => {
                    if (url.startsWith('http')) {
                        const img = document.createElement('img');
                        img.src = url;
                        img.className = 'image-preview';
                        img.alt = 'å›¾ç‰‡é¢„è§ˆ';
                        img.onerror = function() {
                            this.src = 'https://via.placeholder.com/150?text=åŠ è½½å¤±è´¥';
                        };
                        imagePreviewContainer.appendChild(img);
                    }
                });
            });

            // æäº¤æ‰‹åŠ¨è¾“å…¥å†…å®¹
            submitManualBtn.addEventListener('click', function() {
                const url = urlInput.value;
                const title = document.getElementById('manual-title').value;
                const content = document.getElementById('manual-content').value;
                const imagesText = document.getElementById('manual-images').value;
                
                if (!url) {
                    showError('è¯·å…ˆè¾“å…¥å°çº¢ä¹¦å¸–å­URL');
                    return;
                }
                
                if (!title && !content) {
                    showError('è¯·è‡³å°‘è¾“å…¥æ ‡é¢˜æˆ–å†…å®¹');
                    return;
                }
                
                // å¤„ç†å›¾ç‰‡URL
                const images = imagesText.split('\n')
                    .map(u => u.trim())
                    .filter(u => u !== '' && u.startsWith('http'));
                
                submitManualData(url, title, content, images);
            });

            // æäº¤æ‰‹åŠ¨è¾“å…¥çš„æ•°æ®
            function submitManualData(url, title, content, images) {
                showLoading();
                hideError();
                
                fetch('/manual_input', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        url: url,
                        title: title,
                        text: content,
                        images: images
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('æ‰‹åŠ¨è¾“å…¥å¤„ç†å¤±è´¥');
                    }
                    return response.json();
                })
                .then(data => {
                    hideLoading();
                    displayResults(data);
                })
                .catch(err => {
                    hideLoading();
                    showError(err.message);
                });
            }

            // åˆ†ææŒ‰é’®ç‚¹å‡»äº‹ä»¶
            analyzeBtn.addEventListener('click', function() {
                const url = urlInput.value.trim();
                if (!url) {
                    showError('è¯·è¾“å…¥å°çº¢ä¹¦é“¾æ¥');
                    return;
                }
                
                analyzeUrl(url);
            });
            
            // åˆ†æURLå‡½æ•°
            function analyzeUrl(url) {
                showLoading();
                hideError();
                
                fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    
                    if (data.error) {
                        showError(data.error);
                        return;
                    }
                    
                    displayResults(data);
                })
                .catch(error => {
                    hideLoading();
                    showError('åˆ†æå¤±è´¥ï¼Œè¯·ç¨åå†è¯•: ' + error.message);
                });
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            function showLoading() {
                if (loader) loader.style.display = 'block';
                if (resultSection) resultSection.style.display = 'none';
            }
            
            // éšè—åŠ è½½çŠ¶æ€
            function hideLoading() {
                if (loader) loader.style.display = 'none';
            }
            
            // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            function showError(message) {
                if (errorAlert) {
                    errorAlert.textContent = message;
                    errorAlert.style.display = 'block';
                } else {
                    alert(message); // å¤‡ç”¨æ–¹æ¡ˆ
                }
            }
            
            // éšè—é”™è¯¯ä¿¡æ¯
            function hideError() {
                if (errorAlert) errorAlert.style.display = 'none';
            }
            
            // æ˜¾ç¤ºç»“æœ
            function displayResults(data) {
                if (!resultSection) return;
                
                // å°†åŸå§‹å†…å®¹æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
                document.getElementById('original-title').textContent = data.original.title || 'æ— æ ‡é¢˜';
                
                const originalContent = document.getElementById('original-content');
                originalContent.textContent = '';
                
                if (data.original.text) {
                    originalContent.textContent = data.original.text;
                } else {
                    originalContent.textContent = 'æ— å†…å®¹';
                }
                
                document.getElementById('original-image-count').textContent = 
                    data.original.images ? data.original.images.length + ' å¼ ' : 'æ— å›¾ç‰‡';
                
                document.getElementById('original-video').textContent = 
                    data.original.video ? 'æœ‰è§†é¢‘' : 'æ— è§†é¢‘';
                
                // å…³é”®è¯æ˜¾ç¤º
                const keywordsContainer = document.getElementById('keywords-container');
                keywordsContainer.innerHTML = '';
                
                if (data.analysis && data.analysis.keywords && data.analysis.keywords.length > 0) {
                    data.analysis.keywords.forEach(keyword => {
                        const badge = document.createElement('span');
                        badge.className = 'badge keyword-badge me-2 mb-2';
                        badge.textContent = keyword;
                        keywordsContainer.appendChild(badge);
                    });
                } else {
                    keywordsContainer.textContent = 'æ— å…³é”®è¯';
                }
                
                // æ·»åŠ ä¼˜åŒ–æ ‡é¢˜ - ä½¿ç”¨å…³é”®è¯åˆ›å»ºä¼˜åŒ–æ ‡é¢˜
                const optimizedTitle = document.getElementById('optimized-title');
                if (data.analysis && data.analysis.keywords && data.analysis.keywords.length > 0) {
                    const keywords = data.analysis.keywords.slice(0, 3);
                    let title = data.original.title;
                    
                    // å¦‚æœæ˜¯æœªæ‰¾åˆ°æ ‡é¢˜æˆ–æ¨¡æ‹Ÿæ•°æ®ï¼Œä½¿ç”¨å…³é”®è¯ç”Ÿæˆæ ‡é¢˜
                    if (title === 'æœªæ‰¾åˆ°æ ‡é¢˜' || title === 'å°çº¢ä¹¦å†…å®¹ (æ¨¡æ‹Ÿæ•°æ®)') {
                        title = `${keywords.join('ï½œ')} åˆ†äº«`;
                    }
                    
                    optimizedTitle.textContent = title;
                } else {
                    optimizedTitle.textContent = data.original.title || 'æ— æ³•ç”Ÿæˆä¼˜åŒ–æ ‡é¢˜';
                }
                
                // æ·»åŠ ä¼˜åŒ–å†…å®¹ - åŸºäºåŸå§‹å†…å®¹æˆ–æä¾›ç¤ºä¾‹
                const optimizedBody = document.getElementById('optimized-body');
                if (data.original.text && data.original.text !== 'æœªæ‰¾åˆ°å†…å®¹' && 
                    data.original.text !== 'è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„å°çº¢ä¹¦å†…å®¹ï¼Œå› ä¸ºæ— æ³•ä»åŸå§‹URLè·å–æ•°æ®ã€‚è¿™å¯èƒ½æ˜¯ç”±äºåçˆ¬è™«æªæ–½æˆ–è€…ç½‘ç»œé—®é¢˜å¯¼è‡´çš„ã€‚è¯·ç¨åå†è¯•æˆ–è€…æ‰‹åŠ¨è¾“å…¥å†…å®¹ã€‚') {
                    // ä½¿ç”¨åŸå§‹å†…å®¹
                    optimizedBody.textContent = data.original.text;
                } else if (data.analysis && data.analysis.keywords && data.analysis.keywords.length > 0) {
                    // ç”Ÿæˆç¤ºä¾‹å†…å®¹
                    const keywords = data.analysis.keywords.slice(0, 5);
                    optimizedBody.textContent = `ä»Šå¤©æƒ³å’Œå¤§å®¶åˆ†äº«å…³äºã€Œ${keywords[0]}ã€çš„å¿ƒå¾—ï½\n\nä½œä¸º${keywords[1]}çš„çˆ±å¥½è€…ï¼Œæˆ‘ä¸€ç›´åœ¨å¯»æ‰¾å¥½çš„${keywords[2] || 'å†…å®¹'}ã€‚\n\nğŸ’« æ¨èç†ç”±ï¼š\n- è´¨é‡å¥½\n- æ€§ä»·æ¯”é«˜\n- å¾ˆå®ç”¨\n\nğŸŒŸ ä½¿ç”¨ä½“éªŒï¼š\nè¿™ä¸ª${keywords[0]}çœŸçš„å¾ˆèµï¼Œ${keywords[3] || 'æ•ˆæœ'}å‡ºä¹æ„æ–™çš„å¥½ï¼\n\nâœ¨ å°è´´å£«ï¼š\n${keywords[4] || 'å–œæ¬¢'}çš„æœ‹å‹å¯ä»¥è¯•è¯•çœ‹ï¼Œç»å¯¹ä¸ä¼šåæ‚”ï¼\n\n#${keywords[0]} #${keywords[1]} #æ¨è #åˆ†äº«`;
                } else {
                    optimizedBody.textContent = 'æ— æ³•ç”Ÿæˆä¼˜åŒ–å†…å®¹ï¼Œè¯·æä¾›æ›´å¤šä¿¡æ¯ã€‚';
                }
                
                // æ·»åŠ æ”¹è¿›å»ºè®®
                const suggestionsContainer = document.getElementById('suggestions-container');
                suggestionsContainer.innerHTML = '';
                
                const suggestions = [
                    `å»ºè®®åœ¨æ ‡é¢˜ä¸­ä½¿ç”¨æ•°å­—ï¼Œå¦‚"${data.analysis?.keywords?.[0] || 'å†…å®¹'}å¿…çœ‹çš„5ä¸ªç†ç”±"`,
                    'å¢åŠ æ›´å¤šé«˜è´¨é‡å›¾ç‰‡ï¼Œæé«˜å†…å®¹å¸å¼•åŠ›',
                    'åœ¨æ­£æ–‡ä¸­ä½¿ç”¨æ›´å¤šè¡¨æƒ…ç¬¦å·ï¼Œå¢åŠ äº²å’ŒåŠ›',
                    'æ·»åŠ "#è¯é¢˜æ ‡ç­¾"æé«˜æ›å…‰ç‡',
                    'ç»“å°¾å¢åŠ äº’åŠ¨å¼•å¯¼ï¼Œé¼“åŠ±ç‚¹èµå’Œè¯„è®º'
                ];
                
                suggestions.forEach(suggestion => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.className = 'suggestion-item';
                    suggestionItem.textContent = suggestion;
                    suggestionsContainer.appendChild(suggestionItem);
                });
                
                // ç›¸å…³çƒ­é—¨å¸–å­æ˜¾ç¤º
                const topPostsContainer = document.getElementById('top-posts-container');
                topPostsContainer.innerHTML = '';
                
                if (data.analysis && data.analysis.top_posts && data.analysis.top_posts.length > 0) {
                    data.analysis.top_posts.forEach(post => {
                        const postItem = document.createElement('div');
                        postItem.className = 'suggestion-item mb-2';
                        
                        const title = document.createElement('div');
                        title.className = 'fw-bold';
                        title.textContent = post.title;
                        
                        const likesText = document.createElement('div');
                        likesText.innerHTML = `<i class="fas fa-heart text-danger"></i> ${post.likes}`;
                        
                        const link = document.createElement('a');
                        link.href = post.url;
                        link.target = '_blank';
                        link.className = 'btn btn-sm btn-primary mt-1';
                        link.textContent = 'æŸ¥çœ‹è¯¦æƒ…';
                        
                        postItem.appendChild(title);
                        postItem.appendChild(likesText);
                        postItem.appendChild(link);
                        
                        topPostsContainer.appendChild(postItem);
                    });
                } else {
                    topPostsContainer.textContent = 'æ— ç›¸å…³å¸–å­';
                }
                
                // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                resultSection.style.display = 'block';
                resultSection.scrollIntoView({ behavior: 'smooth' });
            }
            
            // å¤åˆ¶æŒ‰é’®åŠŸèƒ½
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetId = this.dataset.target;
                    const targetElem = document.getElementById(targetId);
                    if (targetElem) {
                        const textToCopy = targetElem.textContent;
                        navigator.clipboard.writeText(textToCopy).then(() => {
                            this.textContent = 'å·²å¤åˆ¶!';
                            setTimeout(() => {
                                this.textContent = 'å¤åˆ¶';
                            }, 2000);
                        });
                    }
                });
            });
        });
    </script>
</body>
</html> 